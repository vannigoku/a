<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Actualizar Proyecto</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1>Actualizar Proyecto</h1>

  <form id="formSeleccion">
    <label for="proyecto">Selecciona un proyecto:</label>
    <select id="proyecto" required></select>
    <button type="submit">Cargar</button>
  </form>

  <form id="formActualizar" style="display:none;">
    <input type="hidden" id="idProyecto">

    <label>Título: <input type="text" id="titulo"></label><br>
    <label>Categoría: <input type="text" id="categoria"></label><br>
    <label>Descripción: <input type="text" id="descripcion"></label><br>
    <label>Responsable: <input type="text" id="responsable"></label><br>
    <label>Participantes: <input type="number" id="participantes"></label><br>
    <label>Fecha: <input type="date" id="fecha"></label><br>
    <label>Estatus:
      <select id="estatus">
        <option value="Completado">Completado</option>
        <option value="En proceso">En proceso</option>
      </select>
    </label><br>

    <button type="submit">Actualizar</button>
  </form>

  <a href="index.html">Regresar al menú</a>

  <script>
    let proyectos = [];

    // Cargar lista
    fetch('/api/proyectos')
      .then(res => res.json())
      .then(data => {
        proyectos = data;
        const select = document.getElementById('proyecto');
        data.forEach(p => {
          const option = document.createElement('option');
          option.value = p._id;
          option.textContent = p.titulo;
          select.appendChild(option);
        });
      });

    // Al seleccionar y dar click en cargar
    document.getElementById('formSeleccion').addEventListener('submit', function (e) {
      e.preventDefault();
      const id = document.getElementById('proyecto').value;
      const proyecto = proyectos.find(p => p._id === id);

      document.getElementById('formActualizar').style.display = 'block';
      document.getElementById('idProyecto').value = proyecto._id;
      document.getElementById('titulo').value = proyecto.titulo;
      document.getElementById('categoria').value = proyecto.categoria;
      document.getElementById('descripcion').value = proyecto.descripcion;
      document.getElementById('responsable').value = proyecto.responsable;
      document.getElementById('participantes').value = proyecto.participantes;
      document.getElementById('fecha').value = proyecto.fecha;
      document.getElementById('estatus').value = proyecto.estatus;
    });

    // Enviar actualización
    document.getElementById('formActualizar').addEventListener('submit', async function (e) {
      e.preventDefault();
      const id = document.getElementById('idProyecto').value;

      const datos = {
        titulo: document.getElementById('titulo').value,
        categoria: document.getElementById('categoria').value,
        descripcion: document.getElementById('descripcion').value,
        responsable: document.getElementById('responsable').value,
        participantes: parseInt(document.getElementById('participantes').value),
        fecha: document.getElementById('fecha').value,
        estatus: document.getElementById('estatus').value
      };

      const res = await fetch(`/api/proyectos/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(datos)
      });

      if (res.ok) {
        alert('Proyecto actualizado correctamente');
        location.reload();
      } else {
        alert('Error al actualizar');
      }
    });
  </script>
</body>
</html>

